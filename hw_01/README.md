# Предварительный анализ задачи определения мошеннических финансовых операций

## 1. Цели антифрод-системы

- **Бизнес-цель**: уменьшить ежемесячный ущерб клиентов от мошеннических транзакций. Сумма ущерба не должна превосходить **500 тыс. рублей в месяц**;
- **Качество детекции**: обнаруживать **не менее 98%** всех мошеннических транзакций. Доля корректных транзакций, помеченных мошенническими, **не должна превышать 5%**;
- **Бюджетно-временные**:
    - 3 месяца на MVP;
    - 6 месяцев на внедрение production-решения;
    - стоимость не более 10 млн. рублей.
- **Производительность**: система должна справляться с пиковой нагрузкой в **400 транзакций в секунду**;
- **Безопасность**: полностью исключить утечки конфиденциальных данных клиентов;
- **Техническая реализация**: решение должно базироваться на алгоритмах машинного обучения и работать на облачных ресурсах.

## 2. Метрика машинного обучения

Подходящая метрика: **`Fβ-Score`**, β ∈ (1, 2].

Задача определения мошеннических операций может быть сведена к задаче классификации с известными метриками, однако стоит принять во внимание особенности конкретной решаемой задачи:
- классы сильно несбалансированы --> `Accuracy` не подойдёт;
- требуется находить не менее 98% от всех мошеннических транзакций --> обратить большее внимание на `Recall`;
- доля корректных транзакций, определённых как мошеннические, не должна превышать 5% --> `Precision` для класса "Мошенничество";
- пропуск мошенничества дороже, чем ложное срабатывание --> **`Fβ-Score`** с β > 1.

## 3. Особенности проекта

Объединённое множество вариантов интерпретации MISSION Canvas

| <!-- -->      | <!-- -->        | <!-- -->      |
| :---: | :--- | :--- |
| **M** | Mission | Снизить количество мошеннических транзакций. |
| **M** | Money | Не более **10 млн. рублей** на реализацию. Общий ущерб клиентов за месяц не должен превышать **500 тыс. рублей.** |
| **M** | Metrics | **Бизнес-метрики**: сумма ущерба не более 500 тыс. руб./мес, количество ложных срабатываний не более 5%; <br>**ML-метрики**: `Precision`, `Recall`, `Fβ-Score`; <br>**Системные метрики**: пропускная способность не менее 400 транзакций/сек.|
| **I** | Idea | Модуль на базе алгоритмов ML, способный в реальном времени оценивать, является ли проводимая транзакция мошеннической. |
| **I** | Infrastructure | Облачная инфраструктура, стриминг в реальном времени, высокопроизводительный инференс ML-моделей.  |
| **S** | Strategy | 3 месяца на MVP, 6 месяцев на внедрение production-решения. |
| **S** | Skills | **Команда**: Data Engineer, Data Scientist, ML Engineer, Software Engineer, DevOps Engineer, Project Manager, Security Specialist. |
| **S** | Stakeholders | Руководство компании, команда разработчиков, клиенты. |
| **I** | Inputs | Данные о транзакции. |
| **I** | Interpretation | Система должна выдавать не только класс, но и вероятности классов и причины (например: "крупная сумма"). |
| **O** | Outputs | Предсказание класса транзакции. |
| **N** | Obstacles | Конфиденциальность данных, высокие пики загрузки, облачные ресурсы. |

## 4. Декомпозиция планируемой системы

Система может быть декомпозирована на два основных контура: онлайн и офлайн.

### Онлайн

Для получения предсказаний в реальном времени.

**1. Точка входа в сервис (e.g. NGINX)**
- приём HTTP-запросов;
- балансировка;
- логирование.

**2. Feature Service/Storage (e.g. Redis)**
- извлечение признаков из запроса; 
- получение исторических признаков.

**3. ML Inference Service (e.g. TorchServe)**
- применение ML-модели к вектору признаков;
- возврат скора и параметров для интерпретации.

### Офлайн

Для подготовки данных, обучения моделей, телеметрии.

**4. Пайплайны данных (e.g. Apache Airflow)**
- настройка DAG'ов.

**5. Платформы обучения моделей (e.g. JupyterLab)**
- обучение, валидация, эксперименты с моделями.

**6. Model Registry (e.g. MLflow)**
- версионирование и хранение моделей, данных и артефактов.

**7. Logs, Metrics, Traces (e.g. ELK)**
- сбор, хранение и анализ логов и метрик.

## 5. SMART

SMART-задачи на первый этап проекта: разработка MVP за 3 месяца (~13 недель).

**1. Собрать, проанализировать и подготовить исторические данные**

| <!-- -->     | <!-- -->        |
| :---: | :--- |
| **S** | Получить доступ к историческим данным транзакций (CSV-файлы) за последние 12 месяцев, провести EDA, подготовить датасеты |
| **M** | Подготовить отчёт по EDA, определить набор признаков для модели |
| **A** | При наличии доступа к данным и инструментам для обработки (сервера, Jupyter) |
| **R** | Без качественных данных не построить модель |
| **T** | 2 недели |

**2. Разработать и обучить baseline модель**

| <!-- -->     | <!-- -->        |
| :---: | :--- |
| **S** | Разработать и обучить несколько моделей на исторических данных |
| **M** | Достигнуть целевые показатели метрик, выбрать лучшую модель |
| **A** | При наличии обработанных данных и вычислительных ресурсов |
| **R** | baseline модель - основа антифрод системы |
| **T** | 3 недели |

**3. Спроектировать архитектуру системы**

| <!-- -->     | <!-- -->        |
| :---: | :--- |
| **S** | На основе декомпозиции системы и требований выбрать облачного провайдера и конкретные сервисы |
| **M** | Подготовить документ с архитектурной схемой и обоснованием выбора |
| **A** | При наличии экспертизы в облачных технологиях, архитектуре, ML |
| **R** | Необходимо для разработки MVP |
| **T** | 3 недели |

**4. Разработать end-to-end pipeline**

| <!-- -->     | <!-- -->        |
| :---: | :--- |
| **S** | Разработать минимальную работающую систему с выбранной моделью, онлайн и офлайн контурами |
| **M** | Система принимает транзакцию и возвращает ответ модели |
| **A** | При наличии команды разработчиков |
| **R** | Демонстрация работоспособности |
| **T** | 5 недель |
